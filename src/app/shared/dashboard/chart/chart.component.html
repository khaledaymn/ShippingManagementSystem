<div class="chart-container" [class]="getChartTypeClass()" role="region" [attr.aria-label]="chartData.title + ' chart'">
  <div class="chart-header">
    <h3 class="chart-title" id="chart-title-{{ chartData.type }}">{{ chartData.title }}</h3>
  </div>

  <div *ngIf="isValidChartData; else noData" class="chart-content" [attr.aria-labelledby]="'chart-title-' + chartData.type">
    <!-- Line Chart -->
    <div *ngIf="chartData.type === 'line'" class="line-chart">
      <svg viewBox="0 0 300 150" class="chart-svg">
        <polyline
          [attr.points]="linePoints"
          fill="none"
          [attr.stroke]="chartData.color"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round">
        </polyline>
        <circle
          *ngFor="let point of circlePoints; trackBy: trackByIndex"
          [attr.cx]="point.cx"
          [attr.cy]="point.cy"
          r="4"
          [attr.fill]="chartData.color">
        </circle>
      </svg>
      <div class="chart-labels">
        <span *ngFor="let label of chartData.labels; trackBy: trackByIndex" class="chart-label">{{ label }}</span>
      </div>
      <table class="sr-only" aria-hidden="true">
        <caption>{{ chartData.title }}</caption>
        <thead>
          <tr>
            <th>Label</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let value of chartData.data; let i = index; trackBy: trackByIndex">
            <td>{{ chartData.labels[i] }}</td>
            <td>{{ value }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Bar Chart -->
    <div *ngIf="chartData.type === 'bar'" class="bar-chart">
      <div class="bars-container">
        <div
          *ngFor="let value of chartData.data; let i = index; trackBy: trackByIndex"
          class="bar-item">
          <div
            class="bar"
            [style.height.%]="getBarHeight(value)"
            [style.background-color]="chartData.color">
          </div>
          <span class="bar-label">{{ chartData.labels[i] }}</span>
        </div>
      </div>
      <table class="sr-only" aria-hidden="true">
        <caption>{{ chartData.title }}</caption>
        <thead>
          <tr>
            <th>Label</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let value of chartData.data; let i = index; trackBy: trackByIndex">
            <td>{{ chartData.labels[i] }}</td>
            <td>{{ value }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Doughnut Chart -->
    <div *ngIf="chartData.type === 'doughnut'" class="doughnut-chart">
      <div class="doughnut-container">
        <svg viewBox="0 0 120 120" class="doughnut-svg">
          <circle
            *ngFor="let segment of getDoughnutSegments(); let i = index; trackBy: trackByIndex"
            cx="60"
            cy="60"
            r="40"
            fill="transparent"
            [attr.stroke]="chartData.color"
            [attr.stroke-opacity]="0.2 + (i * 0.2)"
            stroke-width="12"
            [attr.stroke-dasharray]="segment.percentage * 2.51 + ' ' + (251 - segment.percentage * 2.51)"
            [attr.stroke-dashoffset]="251 - (segment.offset * 2.51)"
            transform="rotate(-90 60 60)">
          </circle>
        </svg>
        <div class="doughnut-center">
          <span class="doughnut-total">{{ doughnutTotal }}</span>
        </div>
      </div>
      <div class="doughnut-legend">
        <div
          *ngFor="let label of chartData.labels; let i = index; trackBy: trackByIndex"
          class="legend-item">
          <div
            class="legend-color"
            [style.background-color]="chartData.color"
            [style.opacity]="0.2 + (i * 0.2)">
          </div>
          <span class="legend-label">{{ label }}</span>
        </div>
      </div>
      <table class="sr-only" aria-hidden="true">
        <caption>{{ chartData.title }}</caption>
        <thead>
          <tr>
            <th>Label</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let value of chartData.data; let i = index; trackBy: trackByIndex">
            <td>{{ chartData.labels[i] }}</td>
            <td>{{ value }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Area Chart -->
    <div *ngIf="chartData.type === 'area'" class="area-chart">
      <svg viewBox="0 0 300 150" class="chart-svg">
        <defs>
          <linearGradient id="areaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" [attr.stop-color]="chartData.color" stop-opacity="0.3"/>
            <stop offset="100%" [attr.stop-color]="chartData.color" stop-opacity="0"/>
          </linearGradient>
        </defs>
        <polygon
          [attr.points]="areaPoints"
          fill="url(#areaGradient)">
        </polygon>
        <polyline
          [attr.points]="linePoints"
          fill="none"
          [attr.stroke]="chartData.color"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round">
        </polyline>
      </svg>
      <div class="chart-labels">
        <span *ngFor="let label of chartData.labels; trackBy: trackByIndex" class="chart-label">{{ label }}</span>
      </div>
      <table class="sr-only" aria-hidden="true">
        <caption>{{ chartData.title }}</caption>
        <thead>
          <tr>
            <th>Label</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let value of chartData.data; let i = index; trackBy: trackByIndex">
            <td>{{ chartData.labels[i] }}</td>
            <td>{{ value }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <ng-template #noData>
    <div class="no-data" role="alert">
      No data available for this chart.
    </div>
  </ng-template>
</div>
